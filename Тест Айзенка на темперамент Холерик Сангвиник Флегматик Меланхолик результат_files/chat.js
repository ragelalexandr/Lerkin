var Cloudim={Options:{},Chat:{},Api:{},Events:{},Utils:{}};Cloudim.Options={debug:false,accept_chats:false,Tab:{position:"right",margin:"20px"},Chat:{needName:false,needEmail:false,silent:false}};
Cloudim.Chat={iframe:null,server:"cloudim.ru",is_init:false,user_data:null,page_title:null,title_index:0,site_visible:true,visible:false,blink_interval:null,last_hash:window.location.hash,init:function(a){if(!Cloudim.Chat.is_init){var d="";
for(var b in a){d+="&"+b+"="+encodeURIComponent(a[b]);}Cloudim.Chat.is_init=true;Cloudim.Chat.iframe=document.createElement("iframe");Cloudim.Chat.iframe.id="cloudim_chat";
Cloudim.Chat.iframe.width="310";Cloudim.Chat.iframe.height="0";Cloudim.Chat.iframe.scrolling="no";Cloudim.Chat.iframe.frameBorder="0";Cloudim.Chat.iframe.style.position="fixed";
Cloudim.Chat.iframe.style.bottom="0px";Cloudim.Chat.iframe.style[Cloudim.Options.Tab.position]=Cloudim.Options.Tab.margin;Cloudim.Chat.iframe.style.zIndex="999";
Cloudim.Chat.iframe.style.width="310px";Cloudim.Chat.iframe.style.height="0px";Cloudim.Chat.iframe.style.minHeight="0px";Cloudim.Chat.iframe.src=window.location.protocol+"//"+(Cloudim.Options.debug?"cloudim.local":Cloudim.Chat.server)+"/im/?&silent="+encodeURIComponent(Cloudim.Options.Chat.silent)+"&accept_chats="+encodeURIComponent(Cloudim.Options.accept_chats)+"&need[name]="+encodeURIComponent(Cloudim.Options.Chat.needName)+"&need[email]="+encodeURIComponent(Cloudim.Options.Chat.needEmail)+"&"+d+"&url="+encodeURIComponent(window.location.href)+"&referer="+encodeURIComponent(document.referrer)+"&page="+encodeURIComponent(document.title.substr(0,50));
Cloudim.Chat.iframe.allowTransparency=true;document.body.appendChild(Cloudim.Chat.iframe);var c=document.createElement("div");c.id="cldm_eula_widget-wrapper";
c.style.display="none";c.innerHTML='<style>.cldm_eula_widget--modal{position:fixed!important;top:0!important;left:0!important;right:0!important;bottom:0!important;margin:auto!important;background-color:rgba(0,0,0,.33)!important;z-index:2147483647!important}.cldm_eula_widget--body{position:fixed!important;top:0!important;left:0!important;right:0!important;bottom:0!important;margin:auto!important;width:800px!important;height:530px!important;background-color:#fff!important;background-color:rgba(255,255,255, .95)!important;border:none!important;border-radius:10px;box-sizing:border-box;padding:15px 30px!important}.cldm_eula_widget--frame{margin-top:30px!important;border:none!important;box-sizing:border-box!important;height:470px!important}.cldm_eula_widget--close{position:absolute !important;top:15px !important;right:20px !important;width:15px !important;height:15px !important;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNmlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjarY6xSsNQFEDPi6LiUCsEcXB4kygotupgxqQtRRCs1SHJ1qShSmkSXl7VfoSjWwcXd7/AyVFwUPwC/0Bx6uAQIYODCJ7p3MPlcsGo2HWnYZRhEGvVbjrS9Xw5+8QMUwDQCbPUbrUOAOIkjvjB5ysC4HnTrjsN/sZ8mCoNTIDtbpSFICpA/0KnGsQYMIN+qkHcAaY6addAPAClXu4vQCnI/Q0oKdfzQXwAZs/1fDDmADPIfQUwdXSpAWpJOlJnvVMtq5ZlSbubBJE8HmU6GmRyPw4TlSaqo6MukP8HwGK+2G46cq1qWXvr/DOu58vc3o8QgFh6LFpBOFTn3yqMnd/n4sZ4GQ5vYXpStN0ruNmAheuirVahvAX34y/Axk/96FpPYgAAACBjSFJNAAB6JQAAgIMAAPn/AACA6AAAUggAARVYAAA6lwAAF2/XWh+QAAAAzElEQVR42qyTsRHCMAxFX7xBVoARpFVghKSjhRUyAhmBFVjhMwsDUIgCwwWwA3egOzey35Nt2ZhZa2ariOCbYbdYRAQJOAIHd+/4EO5ueb3cvU3AmOf2c4IJ2AKDpHOSNAIOnLNgWwBXE7CXNAA0EVEyj5L6nO+Affb0uRhPcEkAnGrgG1wQUAMB0mtC0gnYABcggG0J/G/lwpn7uTamGijpXq0qSAVwd29TvoMRWE/ewUPQmFk3147KznaShsbMBNgcWBAALPnlV10HACwiuaGZ5ZweAAAAAElFTkSuQmCC") !important;background-repeat:no-repeat !important;cursor:pointer !important;z-index:1}@media (max-width: 800px){.cldm_eula_widget--body{width:95%!important;height:85%!important;padding:15px 0px!important;overflow:auto;-webkit-overflow-scrolling:touch}.cldm_eula_widget--frame{height:90%!important}}.cldm_eula--hide_if_on{display:none!important}</style><div class="cldm_eula_widget--modal"><div class="cldm_eula_widget--body" onclick="return false;"><div class="cldm_eula_widget--close"></div> <iframe class="cldm_eula_widget--frame" id="cldm_eula--frame" src="" width="100%" height="470" border="0"/></div></div>';
document.body.appendChild(c);Cloudim.Chat.addEvent(document.getElementById("cldm_eula_widget-wrapper"),"click",function(){document.getElementById("cldm_eula_widget-wrapper").style.display="none";
});Cloudim.Chat.page_title=document.title;}},showChat:function(a){Cloudim.Chat.iframe.height="475";Cloudim.Chat.iframe.style.height="475px";Cloudim.Events._callEvent("onOpen");
},chatHeight:function(a){if(typeof a.height!=="undefined"){Cloudim.Chat.iframe.height=a.height;Cloudim.Chat.iframe.style.height=a.height+"px";}},showPanel:function(){if(Cloudim.Chat.iframe.height>0){Cloudim.Events._callEvent("onClose");
}else{Cloudim.Events._callEvent("onShowTab");}Cloudim.Chat.iframe.height="40";Cloudim.Chat.iframe.style.height="40px";},showWelcome:function(){Cloudim.Chat.iframe.height="200";
Cloudim.Chat.iframe.style.height="200px";},showEula:function(a){document.getElementById("cldm_eula_widget-wrapper").style.display="";document.getElementById("cldm_eula--frame").src=a;
},scriptMessage:function(b){if(typeof b.data=="string"&&b.data.substr(0,4)=="!im_"){var a=Cloudim.Utils.evalJSON(b.data.substr(4));if(typeof Cloudim.Chat[a.callback]!="undefined"){Cloudim.Chat[a.callback](a.data);
}}},saveChatSession:function(c){var d=new Date(new Date().getTime()+60*60*1000);document.cookie="__cldm_sess="+encodeURIComponent(c.session)+"; path=/; expires="+d.toUTCString();
var a=new Date(new Date().getTime()+356*24*60*60*1000);document.cookie="__cldm_vis="+encodeURIComponent(c.visit)+"; path=/; expires="+a.toUTCString();if(Cloudim.Utils.getCookie("__cloudim")){var b=new Date(0);
document.cookie="__cloudim=; path=/; expires="+b.toUTCString();}},addEvent:function(c,b,a){if(c.addEventListener){c.addEventListener(b,a,false);}else{if(c.attachEvent){c.attachEvent("on"+b,a);
}else{c["on"+b]=a;}}},callMessageEvent:function(a){if((!Cloudim.Chat.visible&&!Cloudim.Chat.site_visible)&&!Cloudim.Chat.blink_interval){Cloudim.Chat.blink_interval=setInterval(Cloudim.Chat.blinkTitle,1000);
}Cloudim.Events._callEvent("onMessage",a);},callClientMessageEvent:function(a){Cloudim.Events._callEvent("onClientMessage",a);},callTypingEvent:function(a){Cloudim.Events._callEvent("onTyping",a);
},callPreInitEvent:function(){var a={session:Cloudim.Utils.getCookie("__cldm_sess"),visit:Cloudim.Utils.getCookie("__cldm_vis")};Cloudim.Utils.cloudimFunctionCall("sendChatUser",a);
},callInitEvent:function(a){Cloudim.Events._callEvent("onInit",a);},callReadyEvent:function(){Cloudim.Events._callEvent("onReady");},callOnlineEvent:function(){Cloudim.Rules._runRules();
Cloudim.Events._callEvent("onOnline");},callBlurEvent:function(){Cloudim.Chat.visible=false;},callFocusEvent:function(){Cloudim.Chat.visible=true;},callOperatorChangeEvent:function(a){Cloudim.Events._callEvent("onOperatorChange",a);
},callExternalEvent:function(a){Cloudim.Events._callEvent("onExternalEvent",a);},returnCallback:function(a){if(typeof Cloudim.Api.return_callbacks[a.callback_index]!="undefined"){if(typeof Cloudim.Api.return_callbacks[a.callback_index]=="string"){window[Cloudim.Api.return_callbacks[a.callback_index]](a.result);
}else{Cloudim.Api.return_callbacks[a.callback_index](a.result);}Cloudim.Api.return_callbacks[a.callback_index]=undefined;}},blinkTitle:function(){if(Cloudim.Chat.title_index%2){var a=Cloudim.Chat.page_title;
if(Cloudim.Chat.visible||Cloudim.Chat.site_visible){clearInterval(Cloudim.Chat.blink_interval);Cloudim.Chat.blink_interval=null;}}else{var a="*** Новое сообщение! ***";
}Cloudim.Chat.title_index++;document.title=a;}};Cloudim.Utils={initJSON:function(){(function($){$.toJSON=function(o){if(typeof(JSON)=="object"&&JSON.stringify){return JSON.stringify(o);
}var type=typeof(o);if(o===null){return"null";}if(type=="undefined"){return undefined;}if(type=="number"||type=="boolean"){return o+"";}if(type=="string"){return $.quoteString(o);
}if(type=="object"){if(typeof o.toJSON=="function"){return $.toJSON(o.toJSON());}if(o.constructor===Date){var month=o.getUTCMonth()+1;if(month<10){month="0"+month;
}var day=o.getUTCDate();if(day<10){day="0"+day;}var year=o.getUTCFullYear();var hours=o.getUTCHours();if(hours<10){hours="0"+hours;}var minutes=o.getUTCMinutes();
if(minutes<10){minutes="0"+minutes;}var seconds=o.getUTCSeconds();if(seconds<10){seconds="0"+seconds;}var milli=o.getUTCMilliseconds();if(milli<100){milli="0"+milli;
}if(milli<10){milli="0"+milli;}return'"'+year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds+"."+milli+'Z"';}if(o.constructor===Array){var ret=[];
for(var i=0;i<o.length;i++){ret.push($.toJSON(o[i])||"null");}return"["+ret.join(",")+"]";}var pairs=[];for(var k in o){var name;var type=typeof k;if(type=="number"){name='"'+k+'"';
}else{if(type=="string"){name=$.quoteString(k);}else{continue;}}if(typeof o[k]=="function"){continue;}var val=$.toJSON(o[k]);pairs.push(name+":"+val);}return"{"+pairs.join(", ")+"}";
}};$.evalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src);}return eval("("+src+")");};$.secureEvalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src);
}var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@");filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");
filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered)){return eval("("+src+")");}else{try{throw new SyntaxError("Error parsing JSON, source is not valid.");
}catch(e){}}};$.quoteString=function(string){if(string.match(_escapeable)){return'"'+string.replace(_escapeable,function(a){var c=_meta[a];if(typeof c==="string"){return c;
}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16);})+'"';}return'"'+string+'"';};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;
var _meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};})(this);},cloudimFunctionCall:function(c,b){var a={callback:c,data:b};
Cloudim.Chat.iframe.contentWindow.postMessage(Cloudim.Utils.toJSON(a),Cloudim.Chat.iframe.src);},getCookie:function(a){var b=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));
return b?decodeURIComponent(b[1]):"";}};Cloudim.Utils.initJSON();Cloudim.Events={onMessage:[],onClientMessage:[],onOpen:[],onClose:[],onShowTab:[],onInit:[],onReady:[],onOnline:[],onTyping:[],onOperatorChange:[],onExternalEvent:[],_callEvent:function(c,d){if(typeof Cloudim.Events[c]!="undefined"&&Cloudim.Events[c].length>0){for(var b=0,a=Cloudim.Events[c].length;
b<a;b++){Cloudim.Events[c][b](d);}}}};Cloudim.Rules={rules:{},_runRules:function(){for(var a in Cloudim.Rules.rules){Cloudim.Rules.rules[a].condition(Cloudim.Rules.rules[a].action);
}}};Cloudim.Api={return_callbacks:[],bind:function(a,b){if(Cloudim.Events[a]){Cloudim.Events[a][Cloudim.Events[a].length]=b;}},openChat:function(){Cloudim.Utils.cloudimFunctionCall("openChat");
},closeChat:function(){Cloudim.Utils.cloudimFunctionCall("closeChat");},toggleChat:function(){Cloudim.Utils.cloudimFunctionCall("toggleChat");},getCurrentOperator:function(b){var a=Cloudim.Api.return_callbacks.length;
Cloudim.Api.return_callbacks[a]=b;Cloudim.Utils.cloudimFunctionCall("getCurrentOperator",a);},getOnlineOperators:function(b){var a=Cloudim.Api.return_callbacks.length;
Cloudim.Api.return_callbacks[a]=b;Cloudim.Utils.cloudimFunctionCall("getOnlineOperators",a);},getVisitor:function(b){var a=Cloudim.Api.return_callbacks.length;
Cloudim.Api.return_callbacks[a]=b;Cloudim.Utils.cloudimFunctionCall("getVisitor",a);},defineRule:function(a,b){Cloudim.Rules.rules[a]=b;},sendMessageToOperator:function(b,a){if(a!==true&&a!==false){a=true;
}Cloudim.Utils.cloudimFunctionCall("sendMessageToOperator",{message:b,silent:a});},sendMessageToVisitor:function(a){Cloudim.Utils.cloudimFunctionCall("sendMessageToVisitor",a);
},sendUserData:function(a){Cloudim.Utils.cloudimFunctionCall("sendUserData",a);},clearCache:function(a){Cloudim.Utils.cloudimFunctionCall("clearCache",a);
},sendPreMessage:function(a){Cloudim.Utils.cloudimFunctionCall("sendPreMessage",a);},sendInvitesToChat:function(a){Cloudim.Utils.cloudimFunctionCall("sendInvitesToChat",a);
}};Cloudim.Chat.addEvent(window,"message",Cloudim.Chat.scriptMessage);Cloudim.Chat.addEvent(window,"load",Cloudim.Chat.init);Cloudim.Chat.addEvent(window,"blur",function(){Cloudim.Chat.site_visible=false;
});Cloudim.Chat.addEvent(window,"focus",function(){Cloudim.Chat.site_visible=true;});setInterval(function(){if(window.location.hash!=Cloudim.Chat.last_hash){Cloudim.Chat.last_hash=window.location.hash;
var a={url:window.location.href,page:document.title.substr(0,50)};Cloudim.Utils.cloudimFunctionCall("changePageInfo",a);}},700);